<div class="page">
  <div class="page-header">
    <div>
      <p class="eyebrow">Painel administrativo</p>
      <h1>Gerenciar Alunos</h1>
      <p class="muted">Busque, edite e acompanhe os planos dos alunos em um s√≥ lugar.</p>
    </div>
    <button mat-flat-button color="primary" type="button" (click)="abrirModal()">
      <mat-icon>person_add</mat-icon>
      Novo aluno
    </button>
  </div>

  <mat-card class="filters-card">
    <div class="filters-row">
      <mat-form-field appearance="outline" class="search-field">
        <mat-label>Buscar por nome ou email</mat-label>
        <mat-icon matPrefix>search</mat-icon>
        <input matInput type="search" [(ngModel)]="searchTerm" (input)="filtrarAlunos()" />
      </mat-form-field>
      <div class="meta">
        <mat-chip *ngIf="loading" color="accent" selected>Carregando...</mat-chip>
      </div>
    </div>
  </mat-card>

  <mat-card class="list-card">
    <div class="list-head">
      <div>
        <p class="eyebrow">Lista completa</p>
        <h2>Alunos</h2>
      </div>
    </div>

    <div class="loading" *ngIf="loading">
      <mat-progress-spinner diameter="36" mode="indeterminate"></mat-progress-spinner>
    </div>

    <div *ngIf="!loading && alunosFiltrados.length > 0" class="aluno-list">
      <div class="aluno-row" *ngFor="let aluno of alunosFiltrados">
        <div class="avatar-block">
          <img [src]="getAvatarUrl(aluno)" alt="Foto do aluno" />
          <mat-chip disableRipple>{{ aluno.total_checkins || 0 }} check-ins</mat-chip>
        </div>

        <div class="info">
          <div class="name-line">
            <mat-icon class="inline-icon" aria-hidden="true">person</mat-icon>
            <h3>{{ aluno.nome }}</h3>
          </div>
          <p class="muted">
            <mat-icon class="inline-icon" aria-hidden="true">mail</mat-icon>
            {{ aluno.email }}
          </p>
        </div>

        <div class="plano">
          <p class="label">Plano</p>
          <ng-container *ngIf="getNomePlano(aluno); else semPlano">
            <mat-chip class="plano-chip" color="primary" selected>{{ getNomePlano(aluno) }}</mat-chip>
          </ng-container>
          <ng-template #semPlano></ng-template>
          <mat-chip class="status-chip" [ngClass]="getStatusPlano(aluno)">
            {{ getStatusPlano(aluno) === 'vencido' ? 'Vencido' :
               getStatusPlano(aluno) === 'proximo-vencimento' ? 'Vence em breve' :
               getStatusPlano(aluno) === 'ativo' ? 'Ativo' : 'Inativo' }}
          </mat-chip>
        </div>

        <div class="vencimento" *ngIf="aluno.data_vencimento_plano">
          <p class="label">Vencimento</p>
          <p class="valor">{{ formatarData(aluno.data_vencimento_plano) }}</p>
        </div>

        <div class="actions">
          <button mat-icon-button color="accent" type="button" (click)="abrirModalMatricula(aluno)" aria-label="Matricular aluno">
            <mat-icon>school</mat-icon>
          </button>
          <button mat-icon-button color="primary" type="button" (click)="abrirModal(aluno)" aria-label="Editar aluno">
            <mat-icon>edit</mat-icon>
          </button>
          <button mat-icon-button color="warn" type="button" (click)="excluirAluno(aluno)" aria-label="Excluir aluno">
            <mat-icon>delete</mat-icon>
          </button>
        </div>
      </div>
  </div>

  <div *ngIf="!loading && alunosFiltrados.length === 0" class="empty">
    Nenhum aluno encontrado.
  </div>
  </mat-card>
</div>
