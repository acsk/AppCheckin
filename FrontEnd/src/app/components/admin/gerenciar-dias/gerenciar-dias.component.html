<ion-header>
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/admin"></ion-back-button>
    </ion-buttons>
    <ion-title>Gerenciar Dias</ion-title>
    <ion-buttons slot="end">
      <ion-button (click)="abrirModal()">
        <ion-icon slot="icon-only" name="add"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">
  <div class="dias-container">
    <div class="header-info">
      <h2>Dias Cadastrados</h2>
      <p>Gerencie os dias disponíveis para agendamento</p>
    </div>

    <ion-spinner *ngIf="loading" name="crescent"></ion-spinner>

    <ion-list *ngIf="!loading && dias.length > 0">
      <ion-item *ngFor="let dia of dias" class="dia-item">
        <ion-label>
          <h3>{{ formatarData(dia.data) }}</h3>
          <p>{{ getDiaSemana(dia.data) }}</p>
        </ion-label>
        <ion-badge [color]="dia.ativo ? 'success' : 'medium'" slot="end">
          {{ dia.ativo ? 'Ativo' : 'Inativo' }}
        </ion-badge>
        <ion-button fill="clear" size="small" (click)="abrirModal(dia)" slot="end">
          <ion-icon slot="icon-only" name="create"></ion-icon>
        </ion-button>
        <ion-button fill="clear" size="small" color="danger" (click)="desativar(dia)" slot="end">
          <ion-icon slot="icon-only" name="trash"></ion-icon>
        </ion-button>
      </ion-item>
    </ion-list>

    <div *ngIf="!loading && dias.length === 0" class="empty-state">
      <ion-icon name="calendar"></ion-icon>
      <h3>Nenhum dia cadastrado</h3>
      <p>Adicione dias para começar a criar horários</p>
      <ion-button (click)="abrirModal()">
        <ion-icon slot="start" name="add"></ion-icon>
        Adicionar Dia
      </ion-button>
    </div>
  </div>

  <!-- Modal Criar/Editar Dia -->
  <ion-modal [isOpen]="modalAberto" (didDismiss)="fecharModal()">
    <ng-template>
      <ion-header>
        <ion-toolbar>
          <ion-title>{{ modoEdicao ? 'Editar' : 'Novo' }} Dia</ion-title>
          <ion-buttons slot="end">
            <ion-button (click)="fecharModal()">
              <ion-icon name="close"></ion-icon>
            </ion-button>
          </ion-buttons>
        </ion-toolbar>
      </ion-header>
      
      <ion-content class="ion-padding">
        <form [formGroup]="diaForm">
          <ion-item>
            <ion-label position="floating">Data *</ion-label>
            <ion-input formControlName="data" type="date"></ion-input>
          </ion-item>

          <ion-item>
            <ion-label>Ativo</ion-label>
            <ion-toggle formControlName="ativo" slot="end"></ion-toggle>
          </ion-item>

          <ion-button 
            expand="block" 
            (click)="salvarDia()"
            [disabled]="diaForm.invalid"
            class="ion-margin-top"
          >
            <ion-icon slot="start" name="checkmark"></ion-icon>
            {{ modoEdicao ? 'Atualizar' : 'Criar' }}
          </ion-button>
        </form>
      </ion-content>
    </ng-template>
  </ion-modal>
</ion-content>
